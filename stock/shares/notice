

# python manage.py startapp shares 创建模块

# python manage.py makemigrations shares 创建 迁移模型
# python manage.py sqlmigrate shares 0002 展示sql
# python manage.py migrate 迁移


# python manage.py createsuperuser 创建管理员


# python manage.py  closepoll

SELECT code_id FROM `mc_shares_kdj` where j <0 and date_as = '2021-12-24'
and code_id not in (SELECT code_id FROM `mc_shares_ban` )
and code_id not in (SELECT code FROM `mc_shares_name` where name like "%ST%" )
and (code_id < 300000 or code_id > 600000) and code_id < 800000
and  (ABS(j - k) <= 10 or ABS(j - d) <= 10)






SELECT code_id FROM `mc_shares_kdj` where j <20 and date_as = '2021-12-24'
and code_id not in (SELECT code_id FROM `mc_shares_ban` )
and code_id not in (SELECT code FROM `mc_shares_name` where name like "%ST%" )
and (code_id < 300000 or code_id > 600000) and code_id < 800000
and  (ABS(j - k) <= 5 and ABS(j - d) <= 5)


id date_as 交点前一天买数量， 交点买数量， 总符合条件数，拐弯买点数量， 符合条件数
id date_as 交点前一天， 买点, 2天后价值
id date_as 交点， 买点, 2天后价值
id date_as 拐点，买点, 2天后价值


// 查询当前 6开头的 涨幅在 8%的有多少， 涨幅在 3的有多少， 所有的有多少，以采取哪种策略
SELECT code_id,(buy_amount_end - buy_amount)/buy_amount*100  as amount  FROM `mc_shares_compute_detail`
WHERE `shill_account_type` = 3 and date_as = '2021-12-29' and buy_amount < 2000
and code_id < 800000 and code_id > 600000
HAVING amount > 8
ORDER BY `amount` DESC


// 查转折点 -红色
select a.code_id from (select code_id,j from mc_shares_kdj where date_as = '2021-12-31' and j <-5) a
left join  (select  k, d,code_id,j from mc_shares_kdj where date_as = '2021-12-30') b on a.code_id = b.code_id
left join  (select  code_id,p_end from mc_shares where date_as = '2021-12-31') c on a.code_id = c.code_id
left join  (select  code_id,p_end from mc_shares where date_as = '2021-12-30') d on a.code_id = d.code_id
where a.j > b.j and  c.p_end - d.p_end

// 查最接近交点的 -蓝色
SELECT mc_shares_kdj.code_id FROM `mc_shares_kdj`
left join (select p_end,code_id from mc_shares where date_as = '2021-12-29') c on c.code_id = mc_shares_kdj.code_id
left join (select p_end,code_id from mc_shares where date_as = '2021-12-28') d on d.code_id = mc_shares_kdj.code_id
where j <16 and date_as = '2021-12-29' and mc_shares_kdj.code_id not in (SELECT code_id FROM `mc_shares_ban` )
and mc_shares_kdj.code_id not in (SELECT code FROM `mc_shares_name` where name like "%ST%" )
and (mc_shares_kdj.code_id < 300000 or mc_shares_kdj.code_id > 600000)
and mc_shares_kdj.code_id < 800000
and  ((k - j) > 0 and (d - j) > 0) and ((k - j) <=5 and (d - j) <= 5)
and c.p_end > d.p_end

JSON.stringify($('.responsivetable td').map(x=>{return  $('.responsivetable td').eq(x).text()}).toArray())


// j未闭合，趋近于闭合
SELECT mc_shares_kdj.code_id FROM `mc_shares_kdj`
left join (select p_end,code_id from mc_shares where date_as = '2021-12-28') c on c.code_id = mc_shares_kdj.code_id
left join (select p_end,code_id from mc_shares where date_as = '2021-12-27') d on d.code_id = mc_shares_kdj.code_id
where j <16 and date_as = '2021-12-28' and mc_shares_kdj.code_id not in (SELECT code_id FROM `mc_shares_ban` )
and mc_shares_kdj.code_id not in (SELECT code FROM `mc_shares_name` where name like "%ST%" )
and (mc_shares_kdj.code_id < 300000 or mc_shares_kdj.code_id > 600000)
and mc_shares_kdj.code_id < 800000
and  ((k - j) > 0 and (d - j) > 0) and ((k - j) <=5 and (d - j) <= 5)
and c.p_end > d.p_end


// j未闭合，趋近于闭合, 收益大于3%
SELECT mc_shares_kdj.code_id,(e.p_end / c.p_end) as rate FROM `mc_shares_kdj`
left join (select p_end,code_id from mc_shares where date_as = '2021-12-28') c on c.code_id = mc_shares_kdj.code_id
left join (select p_end,code_id from mc_shares where date_as = '2021-12-27') d on d.code_id = mc_shares_kdj.code_id
left join (select p_end,code_id from mc_shares where date_as = '2021-12-31') e on e.code_id = mc_shares_kdj.code_id
where j <16 and date_as = '2021-12-28' and mc_shares_kdj.code_id not in (SELECT code_id FROM `mc_shares_ban` )
and mc_shares_kdj.code_id not in (SELECT code FROM `mc_shares_name` where name like "%ST%" )
and (mc_shares_kdj.code_id < 300000 or mc_shares_kdj.code_id > 600000)
and mc_shares_kdj.code_id < 800000
and  ((k - j) > 0 and (d - j) > 0) and ((k - j) <=5 and (d - j) <= 5)
and c.p_end > d.p_end
having rate > 1.03

// j未闭合，趋近于闭合, 收益亏损
SELECT mc_shares_kdj.code_id,(e.p_max / c.p_end) as rate FROM `mc_shares_kdj`
left join (select p_end,code_id from mc_shares where date_as = '2021-12-28') c on c.code_id = mc_shares_kdj.code_id
left join (select p_end,code_id from mc_shares where date_as = '2021-12-27') d on d.code_id = mc_shares_kdj.code_id
left join (select p_end,code_id,p_max from mc_shares where date_as = '2021-12-31') e on e.code_id = mc_shares_kdj.code_id
where j <16 and date_as = '2021-12-28' and mc_shares_kdj.code_id not in (SELECT code_id FROM `mc_shares_ban` )
and mc_shares_kdj.code_id not in (SELECT code FROM `mc_shares_name` where name like "%ST%" )
and (mc_shares_kdj.code_id < 300000 or mc_shares_kdj.code_id > 600000)
and mc_shares_kdj.code_id < 800000
and  ((k - j) > 0 and (d - j) > 0) and ((k - j) <=5 and (d - j) <= 5)
and c.p_end > d.p_end
having rate < 1


// j未闭合，趋近于闭合, 收益亏损, 板块是上涨的
SELECT mc_shares_kdj.code_id,(e.p_end / c.p_end) as rate FROM `mc_shares_kdj`
left join (select p_end,code_id from mc_shares where date_as = '2021-12-28') c on c.code_id = mc_shares_kdj.code_id
left join (select p_end,code_id from mc_shares where date_as = '2021-12-27') d on d.code_id = mc_shares_kdj.code_id
left join (select p_end,code_id,p_max from mc_shares where date_as = '2021-12-31') e on e.code_id = mc_shares_kdj.code_id
left join (select code_id,industry_code_id from mc_shares_join_industry) f on f.code_id = mc_shares_kdj.code_id
where j <16 and date_as = '2021-12-28' and mc_shares_kdj.code_id not in (SELECT code_id FROM `mc_shares_ban` )
and mc_shares_kdj.code_id not in (SELECT code FROM `mc_shares_name` where name like "%ST%" )
and (mc_shares_kdj.code_id < 300000 or mc_shares_kdj.code_id > 600000)
and mc_shares_kdj.code_id < 800000
and  ((k - j) > 0 and (d - j) > 0) and ((k - j) <=5 and (d - j) <= 5)
and c.p_end > d.p_end
and f.industry_code_id in (
    select mc_shares_industry.code_id from mc_shares_industry
    left join (select code_id,p_end from mc_shares_industry where date_as = '2021-12-27') z on z.code_id = mc_shares_industry.code_id
    where date_as = '2021-12-28' and z.p_end < mc_shares_industry.p_end
    )
having rate < 1


// j未闭合，趋近于闭合, 收益大于3%, 板块是上涨的
SELECT mc_shares_kdj.code_id,(e.p_end / c.p_end) as rate FROM `mc_shares_kdj`
left join (select p_end,code_id from mc_shares where date_as = '2021-12-28') c on c.code_id = mc_shares_kdj.code_id
left join (select p_end,code_id from mc_shares where date_as = '2021-12-27') d on d.code_id = mc_shares_kdj.code_id
left join (select p_end,code_id from mc_shares where date_as = '2021-12-31') e on e.code_id = mc_shares_kdj.code_id
left join (select code_id,industry_code_id from mc_shares_join_industry) f on f.code_id = mc_shares_kdj.code_id
where j <16 and date_as = '2021-12-28' and mc_shares_kdj.code_id not in (SELECT code_id FROM `mc_shares_ban` )
and mc_shares_kdj.code_id not in (SELECT code FROM `mc_shares_name` where name like "%ST%" )
and (mc_shares_kdj.code_id < 300000 or mc_shares_kdj.code_id > 600000)
and mc_shares_kdj.code_id < 800000
and  ((k - j) > 0 and (d - j) > 0) and ((k - j) <=5 and (d - j) <= 5)
and c.p_end > d.p_end
and f.industry_code_id in (
    select mc_shares_industry.code_id from mc_shares_industry
    left join (select code_id,p_end from mc_shares_industry where date_as = '2021-12-27') z on z.code_id = mc_shares_industry.code_id
    where date_as = '2021-12-28' and z.p_end < mc_shares_industry.p_end
    )
having rate > 1.03


